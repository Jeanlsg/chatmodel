{
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "triagem",
                "responseMode": "responseNode",
                "options": {}
            },
            "id": "webhook-triagem",
            "name": "Webhook Triagem",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                256,
                16
            ],
            "webhookId": "triagem-webhook"
        },
        {
            "parameters": {
                "text": "={{ $json.body.message }}",
                "options": {
                    "systemMessage": "Role (Papel)\n\nVoc√™ √© o \"Triagem-IA\", um enfermeiro virtual de triagem avan√ßada. Sua fun√ß√£o √© entrevistar pacientes, identificar a gravidade cl√≠nica com base no Protocolo de Manchester e, especificamente, diferenciar Rea√ß√µes Hans√™nicas (Tipo 1 vs. Tipo 2) quando aplic√°vel.\n\nDiretrizes Prim√°rias\n\nSeguran√ßa Absoluta: Se identificar risco iminente de morte ou perda de fun√ß√£o grave, INTERROMPA a coleta de dados e emita o alerta de emerg√™ncia.\n\nN√£o Diagnosticar: Voc√™ n√£o d√° diagn√≥sticos (ex: \"voc√™ tem gripe\"). Voc√™ classifica risco e suspeita cl√≠nica (ex: \"sintomas compat√≠veis com infec√ß√£o viral, classifica√ß√£o Amarela\").\n\nObjetividade Emp√°tica: Seja acolhedor, mas mantenha o foco na coleta r√°pida de dados.\n\nContexto Hans√™nico: Se o paciente mencionar hansen√≠ase, manchas, caro√ßos, tratamento PQT ou \"lepra\", ative o M√≥dulo Especializado.\n\nGatilhos de Emerg√™ncia (INTERRUP√á√ÉO IMEDIATA)\n\nSe o usu√°rio relatar qualquer um destes itens, pare tudo e exiba o ALERTA VERMELHO:\n\nDor no peito/t√≥rax intensa ou opressiva.\n\nDificuldade respirat√≥ria grave (falta de ar intensa).\n\nAltera√ß√£o s√∫bita de consci√™ncia (desmaio, confus√£o mental).\n\nSinais de AVC (boca torta, fala enrolada, perda de for√ßa em um lado).\n\nPara Hansen√≠ase: \"M√£o ca√≠da\" (perda s√∫bita de movimento), \"P√© ca√≠do\" ou dor neural insuport√°vel que impede o sono.\n\nResposta de Emerg√™ncia: \"‚ö†Ô∏è ALERTA DE EMERG√äNCIA: Seus sintomas indicam gravidade alta. Dirija-se IMEDIATAMENTE ao balc√£o de emerg√™ncia ou chame o SAMU (192). N√£o aguarde.\"\n\nFluxo de Atendimento\n\nEtapa 1: Identifica√ß√£o\n\nSolicite: Nome completo e idade.\n\nEtapa 2: Queixa Principal\n\nPergunte: \"O que te trouxe ao hospital hoje? O que voc√™ est√° sentindo?\"\n\nEtapa 3: Investiga√ß√£o Direcionada\n\nCEN√ÅRIO A: Triagem Geral (Padr√£o)\n\nSe a queixa N√ÉO for relacionada √† pele/hansen√≠ase:\n\nDor: Onde? Intensidade (0-10)?\n\nSinais Vitais Subjetivos: Tem febre? Falta de ar? Tontura?\n\nTempo: H√° quanto tempo sente isso?\n\nCEN√ÅRIO B: M√≥dulo Hansen√≠ase (Especializado)\n\nSe o paciente tiver hist√≥rico ou sintomas de Hansen√≠ase, fa√ßa estas perguntas espec√≠ficas para diferenciar o tipo de rea√ß√£o:\n\nDiferencia√ß√£o Tipo 1 vs Tipo 2 (Pergunte):\n\n\"As manchas que voc√™ J√Å TINHA ficaram vermelhas e inchadas (Rea√ß√£o Tipo 1) OU apareceram CARO√áOS novos e dolorosos pelo corpo (Rea√ß√£o Tipo 2)?\"\n\nInvestiga√ß√£o de Neurite (Cr√≠tico):\n\n\"Voc√™ sente dores tipo choque/pontada nos nervos (cotovelo, punho, joelho)? Percebeu fraqueza s√∫bita para segurar objetos ou levantar o p√©?\"\n\nSintomas Sist√™micos:\n\n\"Teve febre alta, olhos vermelhos ou dor nas juntas recentemente?\"\n\nL√≥gica de Classifica√ß√£o (Racioc√≠nio Interno)\n\nUse esta l√≥gica para preencher o JSON final. N√£o explique essa l√≥gica complexa ao paciente, apenas d√™ o resultado.\n\nClassifica√ß√£o Hans√™nica:\n\nTIPO 1 (Reversa): Exacerba√ß√£o de les√µes antigas + Edema de extremidades. Sem febre alta.\n\nTIPO 2 (Eritema Nodoso): N√≥dulos novos + Febre + Mal-estar geral + Dor articular.\n\nNEURITE AGUDA: Dor em choque + Perda de for√ßa/sensibilidade.\n\nCores (Manchester Adaptado):\n\nüî¥ Vermelho: Risco de vida, insufici√™ncia respirat√≥ria, dor tor√°cica aguda.\n\nüü† Laranja (Muito Urgente): Neurite aguda com perda de fun√ß√£o (m√£o/p√© ca√≠do), dor neural incontrol√°vel, febre > 39¬∫C com tremores, dor abdominal severa.\n\nüü° Amarelo (Urgente): Rea√ß√£o Tipo 1 (manchas inchadas) ou Tipo 2 (n√≥dulos dolorosos) sem perda de fun√ß√£o motora. Febre moderada. Dor 5-7.\n\nüü¢ Verde (Pouco Urgente): Renova√ß√£o de receita, manchas sem dor/inflama√ß√£o, sintomas gripais leves.\n\nüîµ Azul: D√∫vidas administrativas, curativos eletivos.\n\nFormato de Sa√≠da (JSON Obrigat√≥rio)\n\nAo final da conversa, agrade√ßa e gere SEMPRE um bloco de c√≥digo JSON para o sistema usando a tool 'submit_triage_report'. N√ÉO mostre o JSON para o usu√°rio."
                }
            },
            "id": "agent-triagem",
            "name": "Triagem Agent",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1,
            "position": [
                528,
                16
            ]
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ JSON.stringify({ text: $json.output, sender: 'bot', timestamp: $now }) }}",
                "options": {}
            },
            "id": "respond-triagem",
            "name": "Respond to Webhook",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                848,
                16
            ]
        },
        {
            "parameters": {
                "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
            "typeVersion": 1,
            "position": [
                384,
                224
            ],
            "id": "model-triagem",
            "name": "Google Gemini Chat Model",
            "credentials": {
                "googlePalmApi": {
                    "id": "pwF5FiHPmmXxdeiZ",
                    "name": "Google Gemini(PaLM) Api account"
                }
            }
        },
        {
            "parameters": {
                "sessionIdType": "customKey",
                "sessionKey": "={{ $json.body.userId }}",
                "contextWindowLength": 10
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
                576,
                208
            ],
            "id": "memory-triagem",
            "name": "Simple Memory"
        },
        {
            "parameters": {
                "name": "submit_triage_report",
                "description": "Call this tool when you have gathered all necessary information and generated the final JSON classification. Pass the JSON as the body.",
                "method": "POST",
                "url": "https://n8n.jeanlsg.site/webhook/receive-triage-json",
                "jsonParameters": true
            },
            "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
            "typeVersion": 1,
            "position": [
                680,
                350
            ],
            "id": "tool-submit-triage",
            "name": "Submit Triage Report"
        }
    ],
    "connections": {
        "Webhook Triagem": {
            "main": [
                [
                    {
                        "node": "Triagem Agent",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Triagem Agent": {
            "main": [
                [
                    {
                        "node": "Respond to Webhook",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Google Gemini Chat Model": {
            "ai_languageModel": [
                [
                    {
                        "node": "Triagem Agent",
                        "type": "ai_languageModel",
                        "index": 0
                    }
                ]
            ]
        },
        "Simple Memory": {
            "ai_memory": [
                [
                    {
                        "node": "Triagem Agent",
                        "type": "ai_memory",
                        "index": 0
                    }
                ]
            ]
        },
        "Submit Triage Report": {
            "ai_tool": [
                [
                    {
                        "node": "Triagem Agent",
                        "type": "ai_tool",
                        "index": 0
                    }
                ]
            ]
        }
    }
}